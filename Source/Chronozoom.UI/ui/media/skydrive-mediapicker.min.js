var CZ;(function(n){(function(t){(function(t){function c(i,r){f=i;u=r?r:n.HomePageViewModel.getFormById("#auth-edit-contentitem-form");t.logoutButton=$("<button><\/button>",{text:"Logout","class":"cz-skydrive-logout-button",click:p});t.helperText=$("<label><\/label>",{text:"Selected items will be automatically shared","class":"cz-skydrive-help-text"});t.filePicker=l().then(a,o)}function l(){return s(w),WL.fileDialog({mode:"open",select:"single"})}function a(n){h();v(n).then(y,o)}function v(n){switch(n.data.files[0].type){case"photo":i="skydrive-image";break;default:i="skydrive-document"}return e=n.data.files[0].source,WL.api({path:n.data.files[0].id+"/embed",method:"GET"})}function y(n){var r=n.embed_html.match(/src=\"(.*?)\"/i)[1],o=r,s,t,h,c,l;i==="skydrive-image"&&(s=o.split("?")[1].split("&"),s.forEach(function(n){t=n.split("=");t.length===2&&t[0]==="resid"&&(h=t[1]);t.length===2&&t[0]==="authkey"&&(c=t[1])}),o="https://onedrive.live.com/download?resid="+h+"&authkey="+c);l={uri:o,mediaType:i,mediaSource:r,attribution:r,tempSource:e};$.extend(f,l);u.updateMediaInfo()}function o(n){var t=n.error;t.code==="user_canceled"||t.code==="request_canceled"?h():console.log(t.message)}function p(){window.confirm("Are you sure want to logout from Skydrive? All your unsaved changes will be lost.")&&(t.logoutButton.hide(),t.helperText.hide(),t.filePicker.cancel(),WL.logout(),window.location.assign("https://login.live.com/oauth20_logout.srf?client_id="+n.Settings.WLAPIClientID+"&redirect_uri="+window.location.toString()))}function s(n){t.filePickerIframe=$("iframe[sutra=picker]");t.filePickerIframe.length>0?n():setTimeout(s,50,n)}function w(){t.logoutButton.appendTo("body");t.helperText.appendTo("body");$(window).on("resize",r);t.filePickerIframe.load(function(){r();t.filePickerIframe.animate({opacity:1});t.logoutButton.animate({opacity:1});t.helperText.animate({opacity:1})})}function h(){t.logoutButton.remove();t.helperText.remove();$(window).off("resize",r)}function r(){var i=56,n=t.filePickerIframe.offset(),r=t.filePickerIframe.outerHeight(!0),u=parseInt(t.logoutButton.css("margin-left"),10),f=parseInt(t.logoutButton.css("margin-top"),10);t.logoutButton.offset({top:n.top+r-i+f,left:n.left+u});t.helperText.offset({top:n.top+r-i+f+1,left:n.left+u+90})}var u,f,i,e;t.filePicker;t.filePickerIframe;t.logoutButton;t.isEnabled;t.helperText;t.setup=c})(t.SkyDriveMediaPicker||(t.SkyDriveMediaPicker={}));var i=t.SkyDriveMediaPicker})(n.Media||(n.Media={}));var t=n.Media})(CZ||(CZ={}));
/*
//# sourceMappingURL=skydrive-mediapicker.min.js.map
*/